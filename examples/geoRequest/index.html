---
layout: default
published: true
title: GeoRequests and Supplemental Requests
---

<div class="row">
  <div class="col-md-12">
    <h2>Overview</h2>
    <p>This example demonstrates how to make a GeoRequest for the CitySDK and also a supplemental request. It's
       important to consider how the "container" tag works when crafting a GeoRequest. Sometimes a container's
       boundaries surround multiple Census geography boundaries - for example, NYC spans multiple New York state
       counties. Due to the way the ACS API works, we can only retrieve part of the block group's data at once. Because
       of this, we must make supplemental requests to the API to fill in data that we are missing. You can track how
       many of these requests are in flight using the SUPPLEMENTAL_REQUESTS_IN_FLIGHT variable in the Census module.
       When this number is zero, your request has complete data. If it is greater than zero, the SDK is waiting on the
       return of some data. These requests are typically quick as they do not require any geocoding. </p>


    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">1. Select Location</h3>
      </div>
      <div class="panel-body ">

        <div class="form-group">
          <label for="level">Choose Your City</label>

          <select class="reqparam form-control" id="city">
            <option value="Washington_DC">
              Washington, D.C.

            <option value="Seattle_WA">
              Seattle, WA
            </option>
            <option value="San_Francisco_CA">
              San Francisco, CA
            </option>
            <option value="Portland_OR">
              Portland, OR
            </option>
            <option value="NYC_NY">
              New York City, NY
            </option>
            <option value="Montgomery_County_MD">
              Montgomery County, MD
            </option>
            <option value="Fargo_ND">
              Fargo, ND
            </option>
            <option value="Chicago_IL">
              Chicago, IL
            </option>
            <option value="Boston_MA">
              Boston, MA
            </option>
            <option value="Austin_TX">
              Austin, TX
            </option>
            <option value="Asheville_NC">
              Asheville, NC
            </option>
          </select>
        </div>
      </div>
    </div>


    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">2. Choose variables of interest</h3>
      </div>
      <div class="panel-body variable-selection-bar">
        <div class="row">
          <div class="col-md-4">
            <input type="checkbox" id="populationButton" value="population" checked> <label
              for="populationButton">Population</label><br/>
            <input type="checkbox" id="commute_timeButton" value="commute_time"> <label
              for="commute_timeButton">Total Commute Time</label>
          </div>
          <div class="col-md-4">
            <input type="checkbox" id="incomeButton" value="income"> <label for="incomeButton">Median
                                                                                               Income</label><br/>
            <input type="checkbox" id="income_per_capitaButton" value="income_per_capita"> <label
              for="income_per_capitaButton">Income per Capita</label>
          </div>
          <div class="col-md-4">
            <input type="checkbox" id="median_male_ageButton" value="median_male_age"> <label
              for="median_male_ageButton">Median Male Age</label><br/>
            <input type="checkbox" id="median_female_ageButton" value="median_female_age"> <label
              for="median_female_ageButton">Median Female Age</label>
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">3. How Will The Data Be Grouped?</h3>
      </div>
      <div class="panel-body ">
        <div class="form-group">
          <label for="level">Level</label>

          <select class="reqparam form-control" id="level" aria-describedby="level-helpblock">
            <option value="blockGroup" selected>blockGroup</option>
            <option value="place">place</option>
            <option value="tract">tract</option>
          </select>
        </div>
      </div>
    </div>

    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">4. Load the Data</h3>
      </div>
      <div class="panel-body ">
        <button type="button" id="cen-load-the-data" class="center-block btn btn-lg btn-primary">Load Data</button>
      </div>
    </div>


    <div class="panel panel-success">
      <div class="panel-heading">
        <h3 class="panel-title">The Resulting Map</h3>
      </div>
      <div class="panel-body ">


        <ul class="nav nav-tabs" role="tablist">

          <li role="presentation" class="active"><a href="#dataSeriesData" aria-controls="dataSeriesData" role="tab"
                                                    data-toggle="tab">Results</a></li>

          <li role="presentation"><a href="#dataSeriesCode" aria-controls="dataSeriesCode" role="tab" data-toggle="tab">Code
                                                                                                                        Example</a>
          </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="dataSeriesData">

            <div class="loading-icon loading-icon-initialstate"></div>

            <div id="map-canvas" style="height:500px; margin-top: 20px"></div>

            <button class="btn btn-primary btn-sm" id="cenClearMap" style="margin-top: 10px;">Clear Map</button>
          </div><!-- end dataSeriesData -->

          <div role="tabpanel" class="tab-pane" id="dataSeriesCode">
          </div><!-- end dataSeriesCode -->
        </div>


      </div>
    </div>


  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization&signed_in=true"></script>
<script>
  var map;
  var sdk;
  var level;
  var census;
  var aliases;
  var geoCities;
  var variables;

  function initialize() {
    sdk = new CitySdk();
    census = new CensusModule(citySDKdemoConfiguration.apikey);
    level = "place";
    variables = [];

    aliases = {
      "NAME": "Name",
      "B19013_001E": "Median Income",
      "B01003_001E": "Population",
      "B01002_002E": "Median Male Age",
      "B01002_003E": "Median Female Age",
      "B08136_001E": "Total Commute Time",
      "B19301_001E": "Income per Capita"
    };

    geoCities = {
      "Asheville_NC": [35.5800, -82.5558],
      "Austin_TX": [30.2500, -97.7500],
      "Boston_MA": [42.3601, -71.0589],
      "Chicago_IL": [41.8369, -87.6847],
      "Fargo_ND": [46.8772, -96.7894],
      "Montgomery_County_MD": [39.1319, -77.2264],
      "NYC_NY": [40.7127, -74.0059],
      "Portland_OR": [45.5200, -122.6819],
      "San_Francisco_CA": [37.7833, -122.4167],
      "Seattle_WA": [47.6097, -122.3331],
      "Washington_DC": [38.9047, -77.0164]
    };

    var mapOptions = {
      center: {lat: 38.91732, lng: -77.2211},
      zoom: 10
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    map.data.setStyle({
      fillColor: 'blue'
    });

    // global infowindow
    var infowindow = new google.maps.InfoWindow();

    // When the user clicks, open an infowindow
    map.data.addListener('click', function(event) {
      var myHTML = "<h4>"
          + ((level == "blockGroup") ? "Block Group: " : (level == "tract") ? "Tract: " : "") + event.feature.getProperty("NAME")
          + "</h4>"
          + "<div style='width:150px; text-align: left;'>";

      for (var i = 0; i < variables.length; i++) {
        myHTML += "<br><b>" + aliases[variables[i]] + "</b>: " + event.feature.getProperty(variables[i]);
      }

      switch (level) {
        case "blockGroup":
          myHTML += "<p><b>Tract: </b>" + event.feature.getProperty("TRACT") + "</p>";
          break;
        case "tract":
          myHTML += "<p><b>County: </b>" + event.feature.getProperty("COUNTY") + "</p>";
      }

      myHTML += "</div>";

      infowindow.setContent(myHTML);
      infowindow.setPosition(event.latLng);
      infowindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
      infowindow.open(map);
    });

    $('#clear').click(clear);

    jQuery("#cenClearMap").click(clear);
    jQuery("#cen-load-the-data").click(loadCity);

    jQuery(".variable-selection-bar input").click(function() {
      if (jQuery('.variable-selection-bar input:checked').size() > 0) {
        jQuery("#cen-load-the-data").removeAttr("disabled", "disabled");
      } else {
        jQuery("#cen-load-the-data").attr("disabled", "disabled");
      }
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);

  function checkLoading() {
    if (census.supplementalRequestsInFlight == 0) {
      jQuery(".loading-icon-initialstate").hide();
    } else if (census.supplementalRequestsInFlight > 0) {
      window.setTimeout(checkLoading, 1500);
    }
  }

  function clear() {
    map.data.forEach(function(feature) {
      map.data.remove(feature);
    });
  }

  function loadCity() {
    var city = jQuery('#city').val();
    var reqLevel = jQuery('#level').val();

    if (city == "Montgomery_County_MD" && level == "place") {
      reqLevel = "county";
    }

    jQuery(".variable-selection-bar input:checked").each(function(n, o) {
      variables.push(o.value);
    });

    variables = variables.filter(function(n) {
      return n != undefined
    });

    variables = variables.filter(function(n) {
      return n != ""
    });

    jQuery(".loading-icon-initialstate").show();

    map.panTo(new google.maps.LatLng(geoCities[city][0], geoCities[city][1]));

    //BEGIN CITYSDK REQUEST
    var request = {
      "lat": geoCities[city][0],
      "lng": geoCities[city][1],
      "level": reqLevel,
      "variables": variables
    };

    if (reqLevel == "tract" || reqLevel == "blockGroup") {
      request.sublevel = true;
      request.container = (city == "Montgomery_County_MD") ? "county" : "place";
    }

    census.geoRequest(request, function(geojson) {
      checkLoading();
      map.data.addGeoJson(geojson);
    });
    //END CITYSDK REQUEST
  }
</script>
